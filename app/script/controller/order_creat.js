/** * Created by 50683 on 2016/6/14. */var orderCreatModule = angular.module('orderCreatModule', ['travelServiceModule']);orderCreatModule.controller('orderCreatCtrl', ['$scope', '$state', '$stateParams', '$cookieStore', 'travelDetailsService', 'orderCreatService', 'orderValidateService','promptService', function ($scope, $state, $stateParams, $cookieStore, travelDetailsService, orderCreatService, orderValidateService,promptService) {    $scope.parseInt=parseInt;    $cookieStore.put('user_uuid', '5734fda9-61c6-42b4-82ce-b1314e291bbd');    $cookieStore.put('token', '63bae8001c7b61f6d14b5bed19c912be');    var user_uuid= $cookieStore.get('user_uuid'),           user_token=$cookieStore.get('token');     if(!user_token || !user_uuid){      var _location_url=window.location.href;       window.location.href='mastergolf://mastergolf.cn/user/login?url='+_location_url+'';     }    $scope.travleDetailsData ='';    $scope.adult_count = 1;    $scope.child_count = 0;    $scope.link_man = '';    $scope.phone = '';    $scope.insurance_count = 0;    $scope.all_people = 1;    travelDetailsService.traveDetailsGet($stateParams.uuid).success(function (data, header, config, status) {        $scope.travleDetailsData = data.data;        $scope.adult_price = parseInt($scope.travleDetailsData.adult_price)||0;        $scope.child_price =parseInt( $scope.travleDetailsData.child_price)||0;        $scope.assurance_price =parseInt($scope.travleDetailsData.assurance_price)||0;        $scope.total_price = $scope.adult_price * $scope.adult_count + $scope.child_price * $scope.child_count + $scope.assurance_price * $scope.insurance_count;    });    /*     * 计算     * */    var getTotalPric = function () {        $scope.all_people = $scope.adult_count + $scope.child_count;        $scope.insurance_count = $scope.insurance_count > $scope.all_people ? $scope.all_people : $scope.insurance_count;        $scope.total_price = $scope.adult_price * $scope.adult_count + $scope.child_price * $scope.child_count + $scope.assurance_price * $scope.insurance_count;    };    /**     *加法操作     */    $scope.addNumberFn = function (argtext) {        if (argtext === "adult_count") {            $scope.adult_count++;        }        if (argtext === "child_count") {            $scope.child_count++;        }        if (argtext === "insurance_count") {            $scope.insurance_count++;            $scope.insurance_count = $scope.insurance_count > $scope.all_people ? $scope.all_people : $scope.insurance_count;        }        getTotalPric();    };    /**     *减法操作     */    $scope.minusNumberFn = function (argtext) {        if (argtext === "adult_count") {            $scope.adult_count--;            $scope.adult_count = $scope.adult_count <= 1 ? 1 : $scope.adult_count;        }        if (argtext === "child_count") {            $scope.child_count--;            $scope.child_count = $scope.child_count < 0 ? 0 : $scope.child_count;        }        if (argtext === "insurance_count") {            $scope.insurance_count--;            $scope.insurance_count = $scope.insurance_count < 0 ? 0 : $scope.insurance_count;        }        getTotalPric()    };    /*     * 验证操作     * */    var _Vname = false, _Vphone = false;    $scope.bool_submit = false;    $scope.validate = {        Vphone: function (str) {            _Vphone = orderValidateService.phone(str);            $scope.bool_submit = (_Vname && _Vphone);            return _Vphone        },        Vname: function (str) {            _Vname = orderValidateService.name(str);            $scope.bool_submit = (_Vname && _Vphone);            return _Vname        }    };    /*    * 提交订单    * */    $scope.submitOrder= function () {           if(!$scope.bool_submit){                return           }        orderCreatService.ajaxSubmit({            uuid:$stateParams.uuid,            user_uuid:user_uuid,            token:user_token,            adult_count:$scope.adult_count,            child_count:$scope.child_count,            link_man:$scope.link_man,            phone:$scope.phone,            insurance_count:$scope.insurance_count        }).success(function (data, header, config, status) {             if(data.data.state==="OK"){             }else{             }        })    };    $scope.statego = function (url, id) {        pageJumpService.statego(url, id);    };}]);